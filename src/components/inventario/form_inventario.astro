---
// Props: modo ("nuevo" | "editar"), valoresIniciales, categorias, unidades, onSubmit
const { modo = "nuevo", valoresIniciales = {}, categorias = [], unidades = [], onSubmit } = Astro.props;
let categoria = valoresIniciales.categoria ?? "";
let unid_med = valoresIniciales.unid_med ?? "";
let nuevaCategoria = "";
let nuevaUnidad = "";
---

<div class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 animate-fade-in">
  <form class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-lg border-2 border-blue-400 relative animate-fade-in" onsubmit={onSubmit}>
    <h2 class="text-xl font-bold mb-4 text-blue-700 text-center">{modo === "nuevo" ? "Nuevo Inventario" : "Editar Inventario"}</h2>
    <div class="mb-3">
      <label class="block text-sm font-semibold mb-1">Código</label>
      <input type="text" name="codigo" class="border w-full rounded px-2 py-1 focus:ring-2 focus:ring-blue-300" required placeholder="Por ejemplo: ALC-001" value={valoresIniciales.codigo ?? ""} />
    </div>
    <div class="mb-3">
  <label class="block text-sm font-semibold mb-1">Nombre</label>
      <input type="text" name="nombre" class="border w-full rounded px-2 py-1 focus:ring-2 focus:ring-blue-300" required value={valoresIniciales.nombre ?? ""} />
    </div>
    <div class="mb-3">
      <label class="block text-sm font-semibold mb-1">Categoría</label>
      <select name="categoria" class="border w-full rounded px-2 py-1" onchange="if(this.value==='otro'){document.getElementById('nueva-categoria').style.display='block'}else{document.getElementById('nueva-categoria').style.display='none'}" required>
        {categorias.map(cat => <option value={cat} selected={categoria === cat}>{cat}</option>)}
        <option value="otro">Otro...</option>
      </select>
      <input type="text" id="nueva-categoria" name="nueva-categoria" class="border w-full rounded px-2 py-1 mt-2" style="display:none" placeholder="Nueva categoría" />
    </div>
    <div class="mb-3">
      <label class="block text-sm font-semibold mb-1">Unidad de Medida</label>
      <select name="unid_med" class="border w-full rounded px-2 py-1" onchange="if(this.value==='otro'){document.getElementById('nueva-unidad').style.display='block'}else{document.getElementById('nueva-unidad').style.display='none'}" required>
        {unidades.map(u => <option value={u} selected={unid_med === u}>{u}</option>)}
        <option value="otro">Otro...</option>
      </select>
      <input type="text" id="nueva-unidad" name="nueva-unidad" class="border w-full rounded px-2 py-1 mt-2" style="display:none" placeholder="Nueva unidad de medida" />
    </div>
    <div class="mb-3">
      <label class="block text-sm font-semibold mb-1">Cantidad</label>
      <input type="number" name="cantidad" class="border w-full rounded px-2 py-1" min="0" step="1" required value={valoresIniciales.cantidad ?? ""} />
    </div>
    <div class="mb-3">
      <label class="block text-sm font-semibold mb-1">Valor Unitario</label>
      <input type="number" name="valor_unitario" class="border w-full rounded px-2 py-1" min="0" step="0.01" required value={valoresIniciales.valor_unitario ?? ""} />
    </div>
    <div class="flex gap-2 justify-end mt-6">
      <button type="button" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400" onclick="window.dispatchEvent(new CustomEvent('closeFormInventario'))">Cancelar</button>
      <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">{modo === "nuevo" ? "Crear" : "Guardar"}</button>
    </div>
  </form>
</div>

<style>
@keyframes fade-in {
  from { opacity: 0; transform: scale(0.97); }
  to { opacity: 1; transform: scale(1); }
}
.animate-fade-in {
  animation: fade-in 0.3s ease;
}
</style>
