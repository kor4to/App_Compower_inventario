---
import "../../styles/global.css";

import { listKardex } from "../../pages/api/kardex/kardex.ts";

let rows: any[] = [];
try {
  rows = await listKardex();
} catch (error) {
  console.error("Error fetching kardex data:", error);
  rows = [];
}
---

<div class="overflow-x-auto rounded-lg border">
  <table class="border-collapse border border-gray-300 w-full">
    <thead>
      <tr>
        <th rowspan="2" class="border border-gray-300">FECHA</th>
        <th rowspan="2" class="border border-gray-300">DETALLE</th>
        <th rowspan="2" class="border border-gray-300">TIPO</th>
        <th rowspan="2" class="border border-gray-300">VALOR UNITARIO</th>
        <th colspan="2" class="border border-gray-300">ENTRADA</th>
        <th colspan="2" class="border border-gray-300">SALIDA</th>
        <th colspan="2" class="border border-gray-300">SALDO</th>
      </tr>
      <tr>
        <th class="border border-gray-300">CANTIDAD</th>
        <th class="border border-gray-300">VALOR</th>
        <th class="border border-gray-300">CANTIDAD</th>
        <th class="border border-gray-300">VALOR</th>
        <th class="border border-gray-300">CANTIDAD</th>
        <th class="border border-gray-300">VALOR</th>
      </tr>
    </thead>

    <tbody>
      {
        rows.length === 0 ? (
          <tr>
            <td colspan="10" class="border border-gray-300 text-center">
              No hay datos disponibles
            </td>
          </tr>
        ) : (
          rows.map((r: any) => (
            <tr class="hover:bg-slate-100">
              <td class="border border-gray-300 text-center">{r.fecha}</td>
              <td class="border border-gray-300 text-center">{r.detalle}</td>
              <td class="border border-gray-300 text-center">{r.tipo}</td>
              <td class="border border-gray-300 text-center">
                S/. {r.valor_unitario}
              </td>
              <td class="border border-gray-300 text-center">
                {r.tipo === "Compra" ? r.cantidad : "-"}
              </td>
              <td class="border border-gray-300 text-center">
                {r.tipo === "Compra" ? "S/. " + r.valor : "-"}
              </td>
              <td class="border border-gray-300 text-center">
                {r.tipo === "Venta" || r.tipo === "Transferencia"
                  ? r.cantidad
                  : "-"}
              </td>
              <td class="border border-gray-300 text-center">
                {r.tipo === "Venta" || r.tipo === "Transferencia"
                  ? "S/. " + r.valor
                  : "-"}
              </td>
              <td class="border border-gray-300 text-center">
                {r.cantidad_saldo}
              </td>
              <td class="border border-gray-300 text-center">
                S/. {r.valor_saldo}
              </td>
            </tr>
          ))
        )
      }
    </tbody>
  </table>
</div>
