---
import '../../styles/global.css';
---
<div class="max-w-2xl mx-auto p-6">
    <form method="post" action="/api/caja/create" class="space-y-4">
        <!-- Selector de Cuenta -->
        <div class="mb-4">
            <label for="cuenta" class="block text-gray-700 font-medium mb-2">Elegir Cuenta:</label>
            <select id="cuenta" name="cuenta" required class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">Seleccione una cuenta</option>
                <option value="corriente_soles">Corriente en Soles</option>
                <option value="ahorro_soles">Ahorro en Soles</option>
                <option value="ahorro_dolares">Ahorro en Dólares</option>
            </select>
        </div>

        <!-- Contenedor siguiente pasos (inicialmente oculto) -->
        <div id="campos-siguiente" class="hidden">
            <!-- Tipo (se muestra SOLO después de elegir cuenta) -->
            <div id="tipo-container" class="hidden mb-4">
                <label for="tipo" class="block text-gray-700 font-medium mb-2">Tipo:</label>
                <select id="tipo" name="tipo" required class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Seleccione un tipo</option>
                    <option value="asignacion">Asignación</option>
                    <option value="gasto">Gasto</option>
                </select>
            </div>

            <!-- Campos para Asignación (inicialmente ocultos) -->
            <div id="campos-asignacion" class="hidden space-y-4">
                <!-- Empleado -->
                <div class="mb-4">
                    <label for="empleado" class="block text-gray-700 font-medium mb-2">Empleado:</label>
                    <select id="empleado" name="empleado" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Seleccione un empleado</option>
                        <option value="e1">E1</option>
                        <option value="e2">E2</option>
                        <option value="e3">E3</option>
                    </select>
                </div>

                <!-- Centro de Costo -->
                <div class="mb-4">
                    <label for="centro-costo" class="block text-gray-700 font-medium mb-2">Centro de Costo:</label>
                    <select id="centro-costo" name="centro-costo" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Seleccione un centro de costo</option>
                        <option value="c1">C1</option>
                        <option value="c2">C2</option>
                        <option value="c3">C3</option>
                    </select>
                </div>

                <!-- Motivo -->
                <div class="mb-4">
                    <label for="motivo" class="block text-gray-700 font-medium mb-2">Motivo:</label>
                    <select id="motivo" name="motivo" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Seleccione un motivo</option>
                        <option value="m1">M1</option>
                        <option value="m2">M2</option>
                        <option value="m3">M3</option>
                    </select>
                </div>

                <!-- Monto (Asignación) -->
                <div class="mb-4">
                    <label for="monto-asignacion" class="block text-gray-700 font-medium mb-2">Monto:</label>
                    <input type="number" id="monto-asignacion" name="monto-asignacion" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />
                </div>

                <!-- Coordinador -->
                <div class="mb-4">
                    <label for="coordinador" class="block text-gray-700 font-medium mb-2">Coordinador:</label>
                    <select id="coordinador" name="coordinador" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Seleccione un coordinador</option>
                        <option value="z1">Z1</option>
                        <option value="z2">Z2</option>
                        <option value="z3">Z3</option>
                    </select>
                </div>
            </div>

            <!-- Campos para Gasto (inicialmente ocultos) -->
            <div id="campos-gasto" class="hidden space-y-4">
                <!-- Tipo de Documento -->
                <div class="mb-4">
                    <label for="tipo-documento" class="block text-gray-700 font-medium mb-2">Tipo de Documento:</label>
                    <select id="tipo-documento" name="tipo-documento" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Seleccione un tipo de documento</option>
                        <option value="factura">Factura</option>
                        <option value="boleta">Boleta</option>
                    </select>
                </div>

                <!-- Campos específicos para Factura (inicialmente ocultos) -->
                <div id="campos-factura" class="hidden space-y-4">
                    <div class="mb-4">
                        <label for="ruc" class="block text-gray-700 font-medium mb-2">RUC:</label>
                        <input type="text" id="ruc" name="ruc" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>

                    <div class="mb-4">
                        <label for="razon-social" class="block text-gray-700 font-medium mb-2">Razón Social:</label>
                        <input type="text" id="razon-social" name="razon-social" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                </div>

                <!-- Campos comunes para Gasto -->
                <div id="campos-comunes-gasto" class="hidden space-y-4">
                    <div class="mb-4">
                        <label for="proveedor" class="block text-gray-700 font-medium mb-2">Proveedor:</label>
                        <input type="text" id="proveedor" name="proveedor" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>

                    <div class="mb-4">
                        <label for="centro-costo-gasto" class="block text-gray-700 font-medium mb-2">Centro de Costo:</label>
                        <select id="centro-costo-gasto" name="centro-costo-gasto" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="c1">C1</option>
                            <option value="c2">C2</option>
                            <option value="c3">C3</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label for="monto-gasto" class="block text-gray-700 font-medium mb-2">Monto:</label>
                        <input type="number" id="monto-gasto" name="monto-gasto" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                </div>
            </div>

            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded w-full">
                Registrar Egreso
            </button>
        </div>
    </form>
</div>

<script>
    const cuentaEl = document.getElementById('cuenta');
    const camposSiguiente = document.getElementById('campos-siguiente');
    const tipoContainer = document.getElementById('tipo-container');
    const camposAsignacion = document.getElementById('campos-asignacion');
    const camposGasto = document.getElementById('campos-gasto');
    const camposFactura = document.getElementById('campos-factura');
    const camposComunesGasto = document.getElementById('campos-comunes-gasto');

    // helpers (inline to avoid implicit any JSDoc issues)
    const showEl = (el) => { if (el) el.classList.remove('hidden'); };
    const hideEl = (el) => { if (el) el.classList.add('hidden'); };
    const clearValue = (id) => {
        const s = document.getElementById(id);
        if (s instanceof HTMLSelectElement || s instanceof HTMLInputElement) s.value = '';
    };

    // Step 1: show 'tipo' only after selecting 'cuenta'
    if (cuentaEl instanceof HTMLSelectElement) {
        cuentaEl.addEventListener('change', () => {
            if (cuentaEl.value) {
                showEl(camposSiguiente);
                showEl(tipoContainer);
            } else {
                // hide everything after cuenta
                hideEl(tipoContainer);
                hideEl(camposAsignacion);
                hideEl(camposGasto);
                hideEl(camposFactura);
                hideEl(camposComunesGasto);
                hideEl(camposSiguiente);
                // clear dependent selects/inputs
                ['tipo','empleado','centro-costo','motivo','coordinador','tipo-documento','proveedor','centro-costo-gasto'].forEach(clearValue);
            }
        });
    }

    // Step 2: show asignacion OR gasto only after selecting tipo
    const tipoEl = document.getElementById('tipo');
    if (tipoEl instanceof HTMLSelectElement) {
        tipoEl.addEventListener('change', () => {
            const val = tipoEl.value;
            if (val === 'asignacion') {
                showEl(camposAsignacion);
                hideEl(camposGasto);
                // clear gasto-related
                ['tipo-documento','proveedor','centro-costo-gasto'].forEach(clearValue);
                hideEl(camposFactura);
                hideEl(camposComunesGasto);
            } else if (val === 'gasto') {
                showEl(camposGasto);
                hideEl(camposAsignacion);
                // clear asignacion-related
                ['empleado','centro-costo','motivo','coordinador'].forEach(clearValue);
            } else {
                hideEl(camposAsignacion);
                hideEl(camposGasto);
            }
        });
    }

    // Step 3: for gasto, show factura fields only after tipo-documento chosen
    const tipoDocEl = document.getElementById('tipo-documento');
    if (tipoDocEl instanceof HTMLSelectElement) {
        tipoDocEl.addEventListener('change', () => {
            const v = tipoDocEl.value;
            if (v === 'factura') {
                showEl(camposFactura);
                showEl(camposComunesGasto);
            } else if (v === 'boleta') {
                hideEl(camposFactura);
                showEl(camposComunesGasto);
            } else {
                hideEl(camposFactura);
                hideEl(camposComunesGasto);
            }
        });
    }
</script>